{"remainingRequest":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\workspace\\3月\\知识库系统\\admin\\src\\views\\km\\filemanagement\\DraftsList.vue?vue&type=style&index=0&id=0c63f54d&scoped=true&lang=css","dependencies":[{"path":"F:\\workspace\\3月\\知识库系统\\admin\\src\\views\\km\\filemanagement\\DraftsList.vue","mtime":1704718217000},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\css-loader\\index.js","mtime":1709701118026},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1709701116791},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1709701156932},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1709701155248},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1709701116791}],"contextDependencies":[],"result":["\n@import '~@assets/less/common.less';\n\n.titleIndex {\n\n}\n",{"version":3,"sources":["DraftsList.vue"],"names":[],"mappings":";AAolCA;;AAEA;;AAEA","file":"DraftsList.vue","sourceRoot":"src/views/km/filemanagement","sourcesContent":["<template>\n  <a-card :bordered=\"false\">\n    <!-- 查询区域 -->\n    <div class=\"table-page-search-wrapper\">\n      <a-form layout=\"inline\" @keyup.enter.native=\"searchQuery\">\n        <a-row :gutter=\"24\">\n          <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n            <a-form-item label=\"标题\">\n              <a-input placeholder=\"请输入标题\" v-model=\"queryParam.title\"></a-input>\n            </a-form-item>\n          </a-col>\n          <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n            <a-form-item label=\"分类\">\n              <j-dict-select-tag type=\"list\" placeholder=\"请选择分类\" v-model=\"queryParam.category\"\n                                 dictCode=\"km_dict_category\"></j-dict-select-tag>\n            </a-form-item>\n          </a-col>\n          <template v-if=\"toggleSearchStatus\">\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"编号\">\n                <a-input placeholder=\"请输入编号\" v-model=\"queryParam.serialNumber\"></a-input>\n              </a-form-item>\n            </a-col>\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"来源\">\n                <j-multi-select-tag type=\"list_multi\" placeholder=\"请选择来源\" v-model=\"queryParam.sourceList\"\n                                    dictCode=\"km_dict_source\"></j-multi-select-tag>\n\n              </a-form-item>\n            </a-col>\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-model-item label=\"版本状态\">\n                <j-multi-select-tag type=\"list_multi\" v-model=\"queryParam.versionList\" :trigger-change=\"true\"\n                                    placeholder=\"请选择版本状态\" dictCode=\"km_dict_versions\"></j-multi-select-tag>\n              </a-form-model-item>\n            </a-col>\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-model-item label=\"涉及业务\">\n                <j-multi-select-tag type=\"list_multi\" v-model=\"queryParam.businessTypeList\" :trigger-change=\"true\"\n                                    placeholder=\"请选择涉及业务\" dictCode=\"km_dict_business\"></j-multi-select-tag>\n              </a-form-model-item>\n            </a-col>\n\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"关键字\">\n                <a-input placeholder=\"请输入关键字\" v-model=\"queryParam.keywords\"></a-input>\n              </a-form-item>\n            </a-col>\n\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"文号\">\n                <a-input placeholder=\"请输入文号\" v-model=\"queryParam.fileNo\" @change=\"transitionQueryFileNo\"></a-input>\n              </a-form-item>\n            </a-col>\n\n\n            <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"文件类型\">\n                <a-input placeholder=\"请输入文件类型\" v-model=\"queryParam.fileType\"></a-input>\n              </a-form-item>\n            </a-col>\n            <a-col :xl=\"10\" :lg=\"12\" :md=\"14\" :sm=\"48\">\n              <a-form-item label=\"发文时间\">\n                <j-dict-select-tag type=\"list\" placeholder=\"请选择开始时间\" v-model=\"queryParam.pubTimeStart\" style=\"width:40%\"\n                                   dictCode=\"km_dict_year\"></j-dict-select-tag>\n                <span class=\"query-group-split-cust\"></span>\n                <j-dict-select-tag type=\"list\" placeholder=\"请选择结束时间\" v-model=\"queryParam.pubTimeEnd\" style=\"width: 40%\"\n                                   dictCode=\"km_dict_year\"></j-dict-select-tag>\n              </a-form-item>\n            </a-col>\n            <a-col :xl=\"10\" :lg=\"12\" :md=\"14\" :sm=\"48\">\n              <a-form-item label=\"上传时间\">\n                <j-date :show-time=\"true\" date-format=\"YYYY-MM-DD HH:mm:ss\" placeholder=\"请选择开始时间\"\n                        class=\"query-group-cust\" v-model=\"queryParam.createTimeStart\"></j-date>\n                <span class=\"query-group-split-cust\"></span>\n                <j-date :show-time=\"true\" date-format=\"YYYY-MM-DD HH:mm:ss\" placeholder=\"请选择结束时间\"\n                        class=\"query-group-cust\" v-model=\"queryParam.createTimeEnd\"></j-date>\n              </a-form-item>\n            </a-col>\n\n          </template>\n          <a-col :xl=\"6\" :lg=\"7\" :md=\"8\" :sm=\"24\">\n            <span style=\"float: left;overflow: hidden;\" class=\"table-page-search-submitButtons\">\n              <a-button type=\"primary\" @click=\"searchQuery\" icon=\"search\">查询</a-button>\n              <a-button @click=\"searchReset\" icon=\"reload\" style=\"margin-left: 8px\">重置</a-button>\n              <a @click=\"handleToggleSearch\" style=\"margin-left: 8px\">\n                {{ toggleSearchStatus ? '收起' : '展开' }}\n                <a-icon :type=\"toggleSearchStatus ? 'up' : 'down'\"/>\n              </a>\n            </span>\n          </a-col>\n        </a-row>\n      </a-form>\n    </div>\n    <!-- 查询区域-END -->\n\n    <!-- 操作按钮区域 -->\n    <div class=\"table-operator\">\n      <a-button type=\"primary\" icon=\"upload\" @click=\"uploadModules\">上传</a-button>\n      <!--      <a-button type=\"primary\" icon=\"download\" @click=\"handleExportXls('草稿文件夹')\">导出</a-button>-->\n      <a-dropdown v-if=\"selectedRowKeys.length > 0\">\n        <a-menu slot=\"overlay\">\n          <a-menu-item key=\"1\" @click=\"batchDel\">\n            <a-icon type=\"delete\"/>\n            批量删除\n          </a-menu-item>\n          <!--<a-menu-item key=\"2\" @click=\"batchEdit\">-->\n            <!--<a-icon type=\"audit\"/>-->\n            <!--批量提审-->\n          <!--</a-menu-item>-->\n          <a-menu-item key=\"3\" @click=\"downloadKmDocBatch\">\n            <a-icon type=\"vertical-align-bottom\"/>\n            批量下载\n          </a-menu-item>\n        </a-menu>\n        <a-button style=\"margin-left: 8px\"> 批量操作\n          <a-icon type=\"down\"/>\n        </a-button>\n      </a-dropdown>\n    </div>\n\n    <!-- table区域-begin -->\n    <div>\n      <div v-if=\"selectedRowKeys.length > 0\" class=\"ant-alert ant-alert-info\" style=\"margin-bottom: 8px;\">\n        <i class=\"anticon anticon-info-circle ant-alert-icon\"></i> 已选择 <a style=\"font-weight: 600\">{{\n        selectedRowKeys.length }}</a>项\n        <a style=\"margin-left: 24px\" @click=\"onClearSelected\">清空</a>\n      </div>\n\n      <a-table\n        ref=\"table\"\n        size=\"middle\"\n        :scroll=\"{x:true}\"\n        bordered\n        rowKey=\"id\"\n        :columns=\"columns\"\n        :dataSource=\"dataSource\"\n        :pagination=\"ipagination\"\n        :loading=\"loading\"\n        :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\n        @change=\"handleTableChange\">\n\n        // 添加自定义列表插槽\n        <div slot=\"filterDropdown\">\n          <a-card style=\"width: 350px\">\n            <a-checkbox-group @change=\"onColSettingsChange\" v-model=\"settingColumns\" :defaultValue=\"settingColumns\">\n              <a-row>\n                <template v-for=\"(item,index) in defColumns\">\n                  <template v-if=\"item.key!='rowIndex'&& item.dataIndex!='action'\">\n                    <a-col :span=\"12\">\n                      <a-checkbox :value=\"item.dataIndex\">{{ item.title }}</a-checkbox>\n                    </a-col>\n                  </template>\n                </template>\n              </a-row>\n            </a-checkbox-group>\n          </a-card>\n        </div>\n        <a-icon slot=\"filterIcon\" type='setting' title=\"自定义列\"\n                :style=\"{ fontSize:'16px',color:  '#108ee9',minWidth:'50px'}\"/>\n\n\n        <template slot=\"htmlSlot\" slot-scope=\"text\">\n          <div v-html=\"text\"></div>\n        </template>\n        <template slot=\"imgSlot\" slot-scope=\"text\">\n          <span v-if=\"!text\" style=\"font-size: 12px;font-style: italic;\">无图片</span>\n          <img v-else :src=\"getImgView(text)\" height=\"25px\" alt=\"\"\n               style=\"max-width:80px;font-size: 12px;font-style: italic;\"/>\n        </template>\n        <template slot=\"fileSlot\" slot-scope=\"text\">\n          <span v-if=\"!text\" style=\"font-size: 12px;font-style: italic;\">无文件</span>\n          <a-button\n            v-else\n            :ghost=\"true\"\n            type=\"primary\"\n            icon=\"download\"\n            size=\"small\"\n            @click=\"downloadFile(text)\">\n            下载\n          </a-button>\n        </template>\n\n        <span slot=\"action\" slot-scope=\"text, record\">\n          <a-icon type=\"edit\" title=\"编辑\" @click=\"previewKmDoc(record,false)\"\n                  :style=\"{ fontSize: '18px', color: '#1890FF', }\"/>\n\n          <!--<a-popconfirm-->\n            <!--title=\"你是否将文件提交审核?\"-->\n            <!--ok-text=\"确定\"-->\n            <!--cancel-text=\"取消\"-->\n\n            <!--@confirm=\"confirm(record)\">-->\n            <!--<a-icon type=\"audit\" title=\"提审\" href=\"#\" :style=\"{ fontSize: '18px', color: '#1890FF', }\"-->\n                    <!--style=\"margin-left: 5px\"/>-->\n          <!--</a-popconfirm>-->\n\n          <a-popconfirm title=\"确定删除吗?\" @confirm=\"() => handleDelete(record.id)\">\n          <a-icon type=\"delete\" title=\"删除\" :style=\"{ fontSize: '18px', color: '#1890FF', }\" style=\"margin-left: 5px\"/>\n          </a-popconfirm>\n\n          <a-icon type=\"download\" title=\"下载\" @click=\"downloadKmDoc(record)\"\n                  :style=\"{ fontSize: '18px', color: '#1890FF'}\" style=\"margin-left: 5px\"/>\n        </span>\n\n        <span slot=\"docTitle\" slot-scope=\"text,record\">\n          <span v-if=\"record.convertFlag === -1\" :title=record.processMsg><a style=\"color: #d71345\">{{record.title}}</a></span>\n          <span v-else-if=\"record.convertFlag === 0\" title=\"等待转换\"><a style=\"color: #fa8c16\">{{record.title}}</a></span>\n          <span v-else @click=\"previewKmDoc(record,true)\"><a style=\"color: #303133\">{{ record.title}}</a></span>\n        </span>\n\n        <span slot=\"status\" slot-scope=\"text,record\">\n          <a v-if=\"record.status===0\" style=\"color: #000c17\">未提审</a>\n          <a v-if=\"record.status===3\" style=\"color: #d71345\">已拒绝</a>\n        </span>\n\n      </a-table>\n    </div>\n    <upload-modal ref=\"uploadModules\" @ok=\"modalFormOk\"></upload-modal>\n\n    <a-j-modal :title=\"title\"\n               :width=\"width\"\n               :visible=\"visible\"\n               @cancel=\"handleCancel\"\n               @changeShowTitle=\"changeShowTitle\"\n               :show-return=\"showTitlePDF\"\n               cancelText=\"关闭\"\n               :okButtonProps=\"{ class:{'jee-hidden': true} }\">\n      <a-spin :spinning=\"confirmLoading\" style=\"margin-top: 10px;float: left;width: 690px\">\n        <j-form-container v-if=\"!formDisabled&&boolCheckTitle&&!showTitlePDF\">\n          <a-form-model ref=\"form\" :model=\"model\" :rules=\"validatorRules\" slot=\"detail\">\n            <a-row>\n              <a-col :span=\"21\">\n                <a-form-model-item label=\"标题\" style=\"margin-left: -15px\" :labelCol=\"labelCol3\" :wrapperCol=\"wrapperCol3\"\n                                   prop=\"title\">\n                  <a-textarea v-model=\"model.title\" placeholder=\"请输入标题\"\n                              :auto-size=\"{ minRows: 1, maxRows: 3 }\"></a-textarea>\n                </a-form-model-item>\n              </a-col>\n              <a-col :span=\"3\" style=\"text-align: center;margin-top: 4px\">\n                <a-button type=\"primary\" @click=\"checkTitleFun\">查重</a-button>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"分类\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"category\">\n                  <j-dict-select-tag type=\"list\" placeholder=\"请选择分类\" v-model=\"model.category\"\n                                     dictCode=\"km_dict_category\"></j-dict-select-tag>\n                </a-form-model-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"文号\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"fileNo\">\n                  <a-input v-model=\"model.fileNo\" placeholder=\"输入文号\" @change=\"transitionFileNo\"></a-input>\n                </a-form-model-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"来源\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"source\">\n                  <j-dict-select-tag type=\"list\" placeholder=\"请选择来源\" v-model=\"model.source\"\n                                     dictCode=\"km_dict_source\"></j-dict-select-tag>\n                </a-form-model-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"发文时间\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"pubTimeTxt\">\n                  <a-input v-model=\"model.pubTimeTxt\" placeholder=\"输入格式: 2021-01-01\"></a-input>\n                </a-form-model-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"关键字\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"keywords\">\n                  <a-textarea v-model=\"model.keywords\" placeholder=\"请输入关键字\"\n                              :auto-size=\"{ minRows: 1, maxRows: 3 }\"></a-textarea>\n                </a-form-model-item>\n              </a-col>\n\n              <a-col :span=\"12\">\n                <!--专题分类-->\n                <a-form-model-item label=\"专题分类\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\n                  <a-textarea @click=\"showModel(model)\" v-model=\"model.topicIds_dictText\"\n                              placeholder=\"请点击选择专题\" readOnly :auto-size=\"{ minRows: 1, maxRows: 3 }\">\n                  </a-textarea>\n                </a-form-model-item>\n              </a-col>\n\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"涉及业务\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"businessTypes\">\n                  <j-multi-select-tag type=\"list_multi\" v-model=\"model.businessTypes\" :trigger-change=\"true\"\n                                      placeholder=\"请选择涉及业务\" dictCode=\"km_dict_business\"></j-multi-select-tag>\n                </a-form-model-item>\n              </a-col>\n\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"版本状态\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"versions\">\n                  <j-multi-select-tag type=\"list_multi\" v-model=\"model.versions\" :trigger-change=\"true\"\n                                      placeholder=\"请选择版本状态\" dictCode=\"km_dict_versions\"></j-multi-select-tag>\n                </a-form-model-item>\n              </a-col>\n\n\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"归属部门\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"depId\">\n                  <j-select-depart v-model=\"model.depId\" :multi=\"false\"></j-select-depart>\n                </a-form-model-item>\n              </a-col>\n\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"公开方式\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"publicRemark\">\n                  <j-dict-select-tag type=\"list\" placeholder=\"请选择公开方式\" v-model=\"model.publicRemark\"\n                                     dictCode=\"km_dict_public_remark\"></j-dict-select-tag>\n                </a-form-model-item>\n              </a-col>\n\n              <a-col :span=\"24\">\n                <a-form-model-item label=\"备注\" :labelCol=\"labelCol2\" :wrapperCol=\"wrapperCol2\" prop=\"remark\">\n                  <a-textarea v-model=\"model.remark\" placeholder=\"请输入备注\"\n                              :auto-size=\"{ minRows: 1, maxRows: 3 }\"></a-textarea>\n                </a-form-model-item>\n              </a-col>\n\n\n              <a-col :span=\"12\">\n                <a-form-model-item label=\"预览文件\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"keywords\">\n                    <span>\n                        <a-popconfirm v-if=\"resetPreviewShow\"\n                                      title=\"你是否将文件恢复吗?\"\n                                      ok-text=\"确定\"\n                                      cancel-text=\"取消\"\n                                      @confirm=\"resetPreviewFile(model)\">\n                        <a href=\"#\" style=\"margin-left: 20px;color: #1890FF\">恢复</a>\n                          </a-popconfirm>\n                    <a-upload\n                      name=\"file\"\n                      :multiple=\"true\"\n                      :action=\"urlAction+model.id\"\n                      :headers=\"headers\"\n                      @change=\"handleChange\"\n                      :showUploadList=\"false\"\n                    >\n                    <a-button type=\"link\" style=\"color: #1890FF\">更改</a-button>\n                    </a-upload>\n                    </span>\n                </a-form-model-item>\n              </a-col>\n\n              <a-col :span=\"24\" style=\"text-align: center;margin-top: -10px\">\n                <a-button type=\"primary\" @click=\"arrayFun(model)\">确认修改</a-button>\n                <a-button style=\"margin-left: 40px\" @click=\"handleCancel\">取消修改</a-button>\n              </a-col>\n            </a-row>\n          </a-form-model>\n          <subject-modal ref=\"modalForm\" @ok=\"modalFormOk\"></subject-modal>\n        </j-form-container>\n        <div v-if=\"!formDisabled&&!boolCheckTitle&&!showTitlePDF\">\n          <a-form layout=\"inline\" style=\"min-height: 10px\">\n            <a-row>\n              <a-col style=\"background-color:#ededf0\">\n                <h3 style=\"color: #303133;margin-left: 10px;padding:5px\">\n                  <b> </b>\n                  <b style=\"margin-left: 10px\" @click=\"changeBoolCheckTitleFun\">\n                    <a style=\"color:#303133;\">\n                      <a-icon type=\"arrow-left\"/>\n                      <span>&nbsp;&nbsp;返回</span>\n                    </a>\n                  </b>\n                </h3>\n              </a-col>\n              <a-col v-for=\"(item,index) in checkTitleList\" :xl=\"24\" :lg=\"24\" :md=\"24\" :sm=\"24\" :key=\"index\">\n                <p style=\"text-align: left;margin-left: 20px\">\n                  <span class=\"titleIndex\"><b>{{index+1+'、'}}</b></span>\n                  <span @click=\"showPreviewKmDoc(item.id,item.title)\"><a style=\"color: #303133\" v-html=\"item.title\"></a></span>\n                </p>\n              </a-col>\n            </a-row>\n          </a-form>\n        </div>\n      </a-spin>\n\n      <div style=\"float: left;width: 690px\" v-if=\"!formDisabled&&!boolCheckTitle&&showTitlePDF\" >\n        <div>\n          <div>\n            <p-d-f-modal :p-d-furl=\"TitlePDFurl\" />\n          </div>\n        </div>\n      </div>\n      <div style=\"float: right;width: 700px\" >\n        <div>\n          <div>\n            <p-d-f-modal :p-d-furl=\"PDFurl\"  />\n          </div>\n        </div>\n      </div>\n\n    </a-j-modal>\n\n    <b-j-modal :title=\"title\"\n               :width=\"width\"\n               :visible=\"visibleB\"\n               @cancel=\"handleCancel\"\n               cancelText=\"关闭\"\n               :okButtonProps=\"{ class:{'jee-hidden': true} }\">\n      <div>\n        <div>\n          <p-d-f-modal :p-d-furl=\"PDFurl\" :iframeWidth=\"width\" :pdf-loading=\"pdfLoading\" />\n        </div>\n      </div>\n    </b-j-modal>\n\n  </a-card>\n</template>\n\n<script>\n  import {ajaxGetDictItems, getDictItemsFromCache} from '@/api/api'\n  import {ACCESS_TOKEN} from \"@/store/mutation-types\"\n  import '@/assets/less/TableExpand.less'\n  import { mixinDevice } from '@/utils/mixin'\n  import { JeecgListMixin } from '@/mixins/JeecgListMixin'\n  import SubjectModal from './modules/SubjectModal'\n  import UploadModal from './modules/UploadModal'\n  import { httpPostAction, httpAction, getAction, downloadFileName } from '@/api/manage'\n  import Vue from 'vue'\n\n  export default {\n    name: 'DraftsList',\n    mixins: [JeecgListMixin, mixinDevice],\n    components: {\n      UploadModal,\n      SubjectModal,\n    },\n    data() {\n      return {\n        // 重复标题列表\n        checkTitleList: [],\n        showTitlePDF: false,\n        boolCheckTitle: true,\n        // switch 是否公开按钮的的状态\n        // switchPublicFlag: true,\n        // switch 是否允许下载按钮的的状态\n        switchDownloadFlag: true,\n        description: '草稿文件夹管理页面',\n        //表头\n        columns: [],\n        //列设置\n        settingColumns: [],\n        //要filter的字典\n        filterDictCode: 'km_dict_source',\n        //  过滤字段数据\n        filterOptions: [],\n        //列定义\n        defColumns: [\n          {\n            title: '操作',\n            dataIndex: 'action',\n            align: \"center\",\n            fixed: \"left\",\n            width: 105,\n            scopedSlots: {\n              filterDropdown: 'filterDropdown',\n              filterIcon: 'filterIcon',\n              customRender: 'action'\n            }\n          },\n          {\n            title: '编号',\n            align: \"center\",\n            dataIndex: 'serialNumber',\n            sorter: true,\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '7em',\n                },\n              }\n            },\n          },\n          {\n            title: '分类',\n            align: \"center\",\n            dataIndex: 'category_dictText',\n            sorter: true,\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '8em',\n                },\n              };\n            },\n          },\n          {\n            title: '标题',\n            align: \"left\",\n            dataIndex: 'title',\n            scopedSlots: {customRender: 'docTitle'},\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '30em',\n                },\n              };\n            },\n          },\n          {\n            title: '来源',\n            align: \"center\",\n            dataIndex: 'source_dictText',\n            filters: [],\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '7em',\n                },\n              };\n            },\n          },\n          {\n            title: '发文时间',\n            align: \"center\",\n            sorter: true,\n            dataIndex: 'pubTimeTxt',\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '11em',\n                },\n              };\n            },\n          },\n          {\n            title: '版本状态',\n            align: \"center\",\n            dataIndex: 'versions_dictText',\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '12em',\n                },\n              };\n            },\n          },\n          {\n            title: '涉及业务',\n            align: \"center\",\n            dataIndex: 'businessTypes_dictText',\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '12em',\n                },\n              };\n            },\n          },\n          {\n            title: '关键字',\n            align: \"center\",\n            dataIndex: 'keywords',\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '12em',\n                },\n              };\n            },\n          },\n          {\n            title: '文号',\n            align: \"center\",\n            dataIndex: 'fileNo',\n            customCell: () => {\n              return {\n                style: {\n                  'max-width': '12em',\n                },\n              };\n            },\n          },\n          // {\n          //   title: '状态',\n          //   align: \"center\",\n          //   dataIndex: 'status',\n          //   scopedSlots: {customRender: 'status'},\n          //   customCell: () => {\n          //     return {\n          //       style: {\n          //         'max-width': '5em',\n          //       },\n          //     };\n          //   },\n          // },\n\n        ],\n        PDFurl: '',\n        TitlePDFurl: '',\n        visible: false,\n        visibleB: false,\n        model: {},\n        urlAction: window._CONFIG['domianURL'] + \"/KM/kmDoc/changePreviewFile?docId=\",\n        headers: {\n          authorization: 'authorization-text',\n          'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)\n        },\n\n\n        labelCol: {\n          xs: {span: 24},\n          sm: {span: 6},\n        },\n        labelCol1: {\n          xs: {span: 12},\n          sm: {span: 12},\n        },\n        labelCol2: {\n          xs: {span: 3},\n          sm: {span: 3},\n        },\n        labelCol3: {\n          xs: {span: 4},\n          sm: {span: 4},\n        },\n        wrapperCol: {\n          xs: {span: 24},\n          sm: {span: 18},\n        },\n        wrapperCol1: {\n          xs: {span: 10},\n          sm: {span: 10},\n        },\n        wrapperCol2: {\n          xs: {span: 21},\n          sm: {span: 21},\n        },\n        wrapperCol3: {\n          xs: {span: 20},\n          sm: {span: 20},\n        },\n\n        confirmLoading: false,\n        // 用来判断文件是否加载完成\n        loadedRatio: 0,\n        pdfLoading: false,\n        pdfShow: true,\n        resetPreviewShow: false,\n        validatorRules: {\n          depId: [{required: true, message: '请选择部门!'}],\n          pubTimeTxt: [{\n            required: false,\n            pattern: /^[0-9]{4}$|^[0-9]{4}-(?:0[1-9]|1[0-2])$|^(?:[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/,\n            message: '日期格式应为:2021-01-01'\n          }],\n        },\n        formDisabled: false,\n        versions: '',\n        businessTypes: '',\n        title: \"编辑\",\n        width: \"900\",\n        url: {\n          docDPCheck: '/KM/kmDoc/docDPCheck',\n          list: '/KM/kmDoc/listDraft',\n          delete: '/KM/kmDoc/delete',\n          deleteBatch: '/KM/kmDoc/deleteBatch',\n          editBatch: '/KM/kmDoc/submitAuditBatch',\n          downloadKmDoc: '/KM/kmDoc/downloadKmDoc',\n          previewKmDoc: '/KM/kmDoc/previewKmDoc',\n          edit: '/KM/kmDoc/editDraft',\n          resetPreviewFile: '/KM/kmDoc/resetPreviewFile',\n          exportXlsUrl: '/KM/kmDoc/exportXls',\n          submitAuditUrl: '/KM/kmDoc/submitAudit',\n        },\n        dictOptions: {},\n        superFieldList: [],\n      }\n    },\n    created() {\n      this.getSuperFieldList();\n      //设置全局token\n      Vue.prototype.token = Vue.ls.get(ACCESS_TOKEN);\n      window._CONFIG['token'] = Vue.prototype.token;\n\n      // 调用初始化自定义table列表函数\n      this.initColumns();\n      this.initFilterDict();\n\n    },\n    computed: {\n      importExcelUrl: function () {\n        return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n      },\n    },\n    watch: {\n      loadedRatio: {\n        handler(newVal, oldVal) {\n          if (newVal === 1) {\n            this.pdfLoading = false;\n          }\n        }\n      }\n    },\n    methods: {\n\n      changeShowTitle(){\n        this.title= '查找相似标题：' + this.model.title;\n        this.showTitlePDF=false;\n      },\n\n\n      // 加载filter字段选项\n      initFilterDict() {\n        //根据字典Code, 初始化字典数组\n        ajaxGetDictItems(this.filterDictCode, null).then((res) => {\n          if (res.success) {\n            let options = res.result\n            console.log(options);\n            options.forEach((item, index) => {\n              let filterOption = {};\n              filterOption.text = item.title;\n              filterOption.value = item.value;\n              this.filterOptions.push(filterOption);\n            });\n            this.defColumns[4].filters =this.filterOptions;\n          }\n        })\n\n      },\n      // 点击查重触发方法\n      checkTitleFun() {\n        this.title = '查找相似标题：' + this.model.title\n        this.checkTitleList = []\n        let params = {}\n        // replaceTitle = replaceTitle.replace(/\\[/g, '%5B');\n        // replaceTitle = replaceTitle.replace(/\\]/g, '%5D');\n\n        params['docId'] = this.model.id;\n        params['checkType'] = \"1\";\n        params['pageSize']=\"20\";\n        getAction(this.url.docDPCheck, params).then((res) => {\n          if (res.success) {\n            this.checkTitleList = res.result.kmSearchResultVOPage.records\n          } else {\n            this.$message.error('检索失败')\n          }\n          this.loading = false\n        })\n        this.boolCheckTitle = false\n      },\n\n      // 返回编辑界面\n      changeBoolCheckTitleFun() {\n        this.boolCheckTitle = true\n        this.title=\"编辑\";\n      },\n\n      // 显示预览窗口，初始化\n      showPreviewKmDoc(id,title) {\n        this.showTitlePDF=true;\n        this.title=\" \";\n        //this.TitlePDFurl = window._CONFIG['domianURL'] + this.url.previewKmDoc + '?docId=' + id\n        this.PDFurl =  this.url.previewKmDoc + \"?docId=\" + record.id;\n\n      },\n\n      // 部门控件触发方法\n      backDepartInfo(info) {\n        this.model.departIds = this.model.selecteddeparts;\n        console.log(this.model.departIds);\n        console.log(\"info\", info);\n        this.nextDepartOptions = info.map((item, index, arr) => {\n          let c = {label: item.text, value: item.value + \"\"}\n          console.log(c);\n          return c;\n        })\n      },\n\n      transitionFileNo() {\n        // 将输入的中括号 转换为 六角括号\n        if (typeof (this.model.fileNo) !== \"undefined\") {\n          this.model.fileNo = this.model.fileNo.replace(/\\[/g, '〔');\n          this.model.fileNo = this.model.fileNo.replace(/\\]/g, '〕');\n          console.log(this.model.fileNo);\n        }\n      },\n\n\n      transitionQueryFileNo() {\n        // 将输入的中括号 转换为 六角括号\n        if (typeof (this.queryParam.fileNo) !== \"undefined\") {\n          this.queryParam.fileNo = this.queryParam.fileNo.replace(/\\[/g, '〔');\n          this.queryParam.fileNo = this.queryParam.fileNo.replace(/\\]/g, '〕');\n        }\n      },\n\n      // 自定义列表  列设置更改事件\n      onColSettingsChange(checkedValues) {\n        var key = this.$route.name + \":colsettings\";\n        console.log(\"colsettings\", key);\n        Vue.ls.set(key, checkedValues, 30 * 7 * 24 * 60 * 60 * 1000)\n        this.settingColumns = checkedValues;\n        const cols = this.defColumns.filter(item => {\n          if (item.key == 'rowIndex' || item.dataIndex == 'action') {\n            return true\n          }\n          if (this.settingColumns.includes(item.dataIndex)) {\n            return true\n          }\n          return false\n        })\n        this.columns = cols;\n      },\n      // 自定义列表  初始化\n      initColumns() {\n        //权限过滤（列权限控制时打开，修改第二个参数为授权码前缀）\n        //this.defColumns = colAuthFilter(this.defColumns,'testdemo:');\n\n        var key = this.$route.name + \":colsettings\";\n        console.log(\"colsettings\", key);\n        let colSettings = Vue.ls.get(key);\n        if (colSettings == null || colSettings == undefined) {\n          let allSettingColumns = [];\n          this.defColumns.forEach(function (item, i, array) {\n            allSettingColumns.push(item.dataIndex);\n          })\n          this.settingColumns = allSettingColumns;\n          this.columns = this.defColumns;\n        } else {\n          this.settingColumns = colSettings;\n          const cols = this.defColumns.filter(item => {\n            if (item.key == 'rowIndex' || item.dataIndex == 'action') {\n              return true;\n            }\n            if (colSettings.includes(item.dataIndex)) {\n              return true;\n            }\n            return false;\n          })\n          this.columns = cols;\n        }\n      },\n\n      initDictConfig() {\n      },\n      getSuperFieldList() {\n        let fieldList = [];\n        fieldList.push({type: 'string', value: 'serialNumber', text: '编号', dictCode: ''})\n        fieldList.push({type: 'string', value: 'category', text: '分类', dictCode: ''})\n        fieldList.push({type: 'string', value: 'title', text: '标题', dictCode: ''})\n        fieldList.push({type: 'string', value: 'source', text: '来源', dictCode: ''})\n        fieldList.push({type: 'datetime', value: 'pubTime', text: '发文时间'})\n        fieldList.push({type: 'string', value: 'versions', text: '版本状态', dictCode: ''})\n        fieldList.push({type: 'string', value: 'businessTypes', text: '涉及业务', dictCode: ''})\n        fieldList.push({type: 'string', value: 'keywords', text: '关键字', dictCode: ''})\n        fieldList.push({type: 'datetime', value: 'createTime', text: '上传时间'})\n        fieldList.push({type: 'string', value: 'fileType', text: '文件类型', dictCode: ''})\n        this.superFieldList = fieldList\n      },\n      //上传文件\n      uploadModules() {\n        this.$refs.uploadModules.edit();\n        this.$refs.uploadModules.title = \"上传\";\n        this.$refs.uploadModules.disableSubmit = false;\n      },\n      // 下载文件\n      downloadKmDoc(record) {\n        this.$notification.success({\n          message: '文件开始下载...',\n          duration: 1,\n        });\n        downloadFileName(this.url.downloadKmDoc, {docId: record.id})\n      },\n      //批量下载\n      downloadKmDocBatch() {\n        console.log(\"批量下载\")\n        if (!this.url.downloadKmDoc) {\n          this.$message.error(\"请设置url.downloadKmDoc属性!\")\n          return\n        }\n        if (this.selectionRows.length <= 0) {\n          this.$message.warning('请选择一条记录！');\n          return;\n        } else {\n          var that = this;\n          this.$confirm({\n            title: \"确认下载\",\n            content: \"是否下载选中数据?\",\n            onOk: function () {\n              for (var i = 0; i < that.selectionRows.length; i++) {\n                let fileName = i;\n                downloadFileName(that.url.downloadKmDoc, {docId: that.selectionRows[i].id})\n              }\n              //that.loadData();\n              that.onClearSelected();\n            }\n          });\n        }\n      },\n      //显示预览窗口，并初始化配置\n      previewKmDoc(record, boolFormDisabled) {\n        if (boolFormDisabled) {\n          this.title = '预览 - ' + record.title;\n          this.visibleB = true;\n        } else {\n          this.title = '编辑 - ' + record.title;\n          this.visible = true;\n        }\n        this.model = {};\n        this.model = Object.assign({}, record);\n\n        console.log(\"model\", this.model);\n\n        this.boolCheckTitle=true;\n        this.showTitlePDF=false;\n        if (this.model.depId == null || this.model.depId === \"\") {\n          var depId = Vue.ls.get(\"Dep_ID\");\n          console.log(\"部门数据为空,从本地中获取数据\", depId);\n          this.model.depId = depId\n        }\n        this.versions = this.model.versions;\n        this.formDisabled = boolFormDisabled;\n        this.businessTypes = this.model.businessTypes;\n        // this.PDFurl = window._CONFIG['domianURL'] + this.url.previewKmDoc + \"?docId=\" + record.id;\n        this.PDFurl =  this.url.previewKmDoc + \"?docId=\" + record.id;\n\n        this.pdfLoading = true;\n        this.pdfShow = true;\n        if (this.model.previewFileId != this.model.originalPreviewFileId) {\n          this.resetPreviewShow = true;\n        }\n\n        //  将是否允许下载状态从 1 和 0 转为 switch的true和false\n        if (this.model.downloadFlag === 1) {\n          this.switchDownloadFlag = true;\n        } else {\n          this.switchDownloadFlag = false;\n        }\n\n\n      },\n      //关闭预览窗口\n      handleCancel() {\n        this.visible = false;\n        this.visibleB = false;\n        this.model = {};\n      },\n\n      // 提审\n      confirm(record) {\n        let httpurl = '';\n        let method = '';\n        let person = {id: record.id};\n        httpurl += this.url.submitAuditUrl;\n        method = 'put';\n        httpPostAction(httpurl, person, method).then((res) => {\n          if (res.success) {\n            this.$message.success(\"提审成功!\");\n            this.loadData();\n          } else {\n            this.$message.warning(\"提审失败!\");\n          }\n        }).finally(() => {\n        })\n      },\n\n\n      //恢复预览文件\n      resetPreviewFile(model) {\n        let httpurl = '';\n        let method = '';\n        httpurl += this.url.resetPreviewFile;\n        method = 'post';\n        this.pdfLoading = true;\n        this.pdfShow = false;\n        httpPostAction(httpurl, {docId: model.id}, method).then((res) => {\n          if (res.success) {\n            this.$message.success(\"恢复成功!\");\n            this.pdfShow = true;\n            this.resetPreviewShow = false;\n            this.loadData();\n          } else {\n            this.$message.warning(\"恢复失败!\");\n            this.pdfShow = true;\n            this.pdfLoading = false;\n          }\n        }).finally(() => {\n          this.pdfShow = true;\n        })\n      },\n\n\n      //  比较数组并提交修改\n      arrayFun(model) {\n\n        // 触发表单验证\n        this.$refs.form.validate(valid => {\n          if (valid) {\n            if (model.versions === this.versions) {\n              console.log(\"不操作versions\")\n            } else if (model.versions === \"\") {\n              model.removeVersionList = this.versions.split(',');\n            } else if (this.versions == null) {\n              model.addVersionList = model.versions.split(',');\n            } else {\n              var versionsArr = model.versions.split(',');\n              var versionsArrConst = this.versions.split(',');\n              model.addVersionList = [];\n              model.removeVersionList = [];\n              for (let i = 0; i < versionsArr.length; i++) {\n                for (let j = 0; j < versionsArrConst.length; j++) {\n                  if (versionsArr[i] === versionsArrConst[j]) {\n                    delete versionsArr[i];\n                    delete versionsArrConst[j];\n                  }\n                }\n              }\n\n              for (let i = 0; i < versionsArr.length; i++) {\n                if (typeof (versionsArr[i]) != \"undefined\") {\n                  model.addVersionList.push(versionsArr[i]);\n                }\n              }\n              for (let i = 0; i < versionsArrConst.length; i++) {\n                if (typeof (versionsArrConst[i]) != \"undefined\") {\n                  model.removeVersionList.push(versionsArrConst[i]);\n                }\n              }\n            }\n            if (model.businessTypes === this.businessTypes) {\n              console.log(\"不操作businessTypes\");\n            } else if (model.businessTypes === \"\") {\n              model.removeBusinessTypeList = this.businessTypes.split(',');\n            } else if (this.businessTypes == null) {\n              model.addBusinessTypeList = model.businessTypes.split(',');\n            } else {\n              var businessTypesArr = model.businessTypes.split(',');\n              var businessTypesArrConst = this.businessTypes.split(',');\n              model.addBusinessTypeList = [];\n              model.removeBusinessTypeList = [];\n              for (let i = 0; i < businessTypesArr.length; i++) {\n                for (let j = 0; j < businessTypesArrConst.length; j++) {\n                  if (businessTypesArr[i] === businessTypesArrConst[j]) {\n                    delete businessTypesArr[i];\n                    delete businessTypesArrConst[j];\n                  }\n                }\n              }\n              for (let i = 0; i < businessTypesArr.length; i++) {\n                if (typeof (businessTypesArr[i]) != \"undefined\") {\n                  model.addBusinessTypeList.push(businessTypesArr[i]);\n                }\n              }\n              for (let i = 0; i < businessTypesArrConst.length; i++) {\n                if (typeof (businessTypesArrConst[i]) != \"undefined\") {\n                  model.removeBusinessTypeList.push(businessTypesArrConst[i]);\n                }\n              }\n            }\n            // 之前将状态 1或者0 改为 true和false 现在将 true和false改为 1和0\n            if (this.switchDownloadFlag === false) {\n              this.model.downloadFlag = 0;\n            } else {\n              this.model.downloadFlag = 1;\n            }\n            Vue.ls.set(\"Dep_ID\", this.model.depId, 7 * 24 * 60 * 60 * 1000)\n            console.log(this.model);\n            httpAction(this.url.edit, model, 'put').then((res) => {\n              if (res.success) {\n                this.$message.success(res.message);\n                this.handleCancel();\n                this.loadData();\n              } else {\n                this.$message.warning(res.message);\n              }\n            }).finally(() => {\n            })\n          } else {\n            return false;\n          }\n        })\n      },\n      // 更改预览文件方法\n      handleChange(info) {\n        this.pdfLoading = true;\n        this.pdfShow = false;\n        if (info.file.status === 'done') {\n          if (info.file.response.code === 200) {\n            this.$message.success(`${info.file.name} 文件上传成功`);\n            this.pdfShow = true;\n            this.resetPreviewShow = true;\n            this.loadData();\n          } else {\n            this.$message.error(`${info.file.name} 文件上传失败${info.file.response.message}`)\n            this.pdfShow = true;\n            this.pdfLoading = false;\n          }\n        } else if (info.file.status === 'error') {\n          this.$message.error(`${info.file.name} 文件上传失败`)\n          this.pdfShow = true;\n          this.pdfLoading = false;\n        }\n\n      },\n\n      //  显示专题\n      showModel(model) {\n        this.$refs.modalForm.edit(model, 0);\n        this.$refs.modalForm.title = \"选择专题\"\n      },\n    }\n  }\n</script>\n<style scoped>\n  @import '~@assets/less/common.less';\n\n  .titleIndex {\n\n  }\n</style>"]}]}