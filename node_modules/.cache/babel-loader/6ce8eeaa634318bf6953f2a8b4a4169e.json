{"remainingRequest":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js!F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\workspace\\3月\\知识库系统\\admin\\src\\cas\\sso.js","dependencies":[{"path":"F:\\workspace\\3月\\知识库系统\\admin\\src\\cas\\sso.js","mtime":1704718217000},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\babel.config.js","mtime":1704718217000},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1709701155248},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1709701140363},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1709701151904}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nimport store from '@/store';\n/**\n * 单点登录\n */\nvar init = function init(callback) {\n  if (process.env.VUE_APP_SSO == 'true') {\n    console.log(\"-------单点登录开始-------\");\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    var st = getUrlParam(\"ticket\");\n    var sevice = \"http://\" + window.location.host + \"/\";\n    if (token) {\n      loginSuccess(callback);\n    } else {\n      if (st) {\n        validateSt(st, sevice, callback);\n      } else {\n        var serviceUrl = encodeURIComponent(sevice);\n        window.location.href = window._CONFIG['casPrefixUrl'] + \"/login?service=\" + serviceUrl;\n      }\n    }\n    console.log(\"-------单点登录结束-------\");\n  } else {\n    callback && callback();\n  }\n};\nvar SSO = {\n  init: init\n};\nfunction getUrlParam(paraName) {\n  var url = document.location.toString();\n  var arrObj = url.split(\"?\");\n  if (arrObj.length > 1) {\n    var arrPara = arrObj[1].split(\"&\");\n    var arr;\n    for (var i = 0; i < arrPara.length; i++) {\n      arr = arrPara[i].split(\"=\");\n      if (arr != null && arr[0] == paraName) {\n        return arr[1];\n      }\n    }\n    return \"\";\n  } else {\n    return \"\";\n  }\n}\nfunction validateSt(ticket, service, callback) {\n  var params = {\n    ticket: ticket,\n    service: service\n  };\n  store.dispatch('ValidateLogin', params).then(function (res) {\n    //this.departConfirm(res)\n    if (res.success) {\n      loginSuccess(callback);\n    } else {\n      var sevice = \"http://\" + window.location.host + \"/\";\n      var serviceUrl = encodeURIComponent(sevice);\n      window.location.href = window._CONFIG['casPrefixUrl'] + \"/login?service=\" + serviceUrl;\n    }\n  }).catch(function (err) {\n    console.log(err);\n    //that.requestFailed(err);\n  });\n}\nfunction loginSuccess(callback) {\n  callback();\n}\nexport default SSO;",{"version":3,"names":["Vue","ACCESS_TOKEN","store","init","callback","process","env","VUE_APP_SSO","console","log","token","ls","get","st","getUrlParam","sevice","window","location","host","loginSuccess","validateSt","serviceUrl","encodeURIComponent","href","_CONFIG","SSO","paraName","url","document","toString","arrObj","split","length","arrPara","arr","i","ticket","service","params","dispatch","then","res","success","catch","err"],"sources":["F:/workspace/3月/知识库系统/admin/src/cas/sso.js"],"sourcesContent":["import Vue from 'vue'\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\"\nimport store from '@/store'\n/**\n * 单点登录\n */\nconst init = (callback) => {\n  if (process.env.VUE_APP_SSO == 'true') {\n    console.log(\"-------单点登录开始-------\");\n    let token = Vue.ls.get(ACCESS_TOKEN);\n    let st = getUrlParam(\"ticket\");\n    let sevice = \"http://\" + window.location.host + \"/\";\n    if (token) {\n      loginSuccess(callback);\n    } else {\n      if (st) {\n        validateSt(st, sevice, callback);\n      } else {\n        let serviceUrl = encodeURIComponent(sevice);\n        window.location.href = window._CONFIG['casPrefixUrl'] + \"/login?service=\" + serviceUrl;\n      }\n    }\n    console.log(\"-------单点登录结束-------\");\n  }else{\n    callback && callback()\n  }\n};\nconst SSO = {\n  init: init\n};\n\nfunction getUrlParam(paraName) {\n  let url = document.location.toString();\n  let arrObj = url.split(\"?\");\n\n  if (arrObj.length > 1) {\n    let arrPara = arrObj[1].split(\"&\");\n    let arr;\n\n    for (let i = 0; i < arrPara.length; i++) {\n      arr = arrPara[i].split(\"=\");\n\n      if (arr != null && arr[0] == paraName) {\n        return arr[1];\n      }\n    }\n    return \"\";\n  }\n  else {\n    return \"\";\n  }\n}\n\nfunction validateSt(ticket,service,callback){\n  let params = {\n    ticket: ticket,\n    service:service\n  };\n  store.dispatch('ValidateLogin',params).then(res => {\n    //this.departConfirm(res)\n    if(res.success){\n      loginSuccess(callback);\n    }else{\n      let sevice = \"http://\"+window.location.host+\"/\";\n      let serviceUrl = encodeURIComponent(sevice);\n      window.location.href = window._CONFIG['casPrefixUrl']+\"/login?service=\"+serviceUrl;\n    }\n  }).catch((err) => {\n    console.log(err);\n    //that.requestFailed(err);\n  });\n}\n\nfunction loginSuccess (callback) {\n  callback();\n}\nexport default SSO;"],"mappings":"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","ignoreList":[]}]}