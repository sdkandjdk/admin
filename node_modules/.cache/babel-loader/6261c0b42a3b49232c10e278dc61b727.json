{"remainingRequest":"D:\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\知识库系统\\admin\\src\\components\\jeecg\\JImageUpload.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\知识库系统\\admin\\src\\components\\jeecg\\JImageUpload.vue","mtime":1704718216000},{"path":"D:\\知识库系统\\admin\\babel.config.js","mtime":1704718216000},{"path":"D:\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nimport { getFileAccessHttpUrl } from '@/api/manage';\nvar uidGenerator = function uidGenerator() {\n  return '-' + parseInt(Math.random() * 10000 + 1, 10);\n};\nvar getFileName = function getFileName(path) {\n  if (path.lastIndexOf(\"\\\\\") >= 0) {\n    var reg = new RegExp(\"\\\\\\\\\", \"g\");\n    path = path.replace(reg, \"/\");\n  }\n  return path.substring(path.lastIndexOf(\"/\") + 1);\n};\nexport default {\n  name: 'JImageUpload',\n  data: function data() {\n    return {\n      uploadAction: window._CONFIG['domianURL'] + \"/sys/common/upload\",\n      uploadLoading: false,\n      picUrl: false,\n      headers: {},\n      fileList: [],\n      previewImage: \"\",\n      previewVisible: false\n    };\n  },\n  props: {\n    text: {\n      type: String,\n      required: false,\n      default: \"上传\"\n    },\n    /*这个属性用于控制文件上传的业务路径*/\n    bizPath: {\n      type: String,\n      required: false,\n      default: \"temp\"\n    },\n    value: {\n      type: [String, Array],\n      required: false\n    },\n    disabled: {\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    isMultiple: {\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 新增number属性，用于判断上传数量\n    number: {\n      type: Number,\n      required: false,\n      default: 0\n    }\n    //update-end-author:wangshuai date:20201021 for:LOWCOD-969 新增number属性，用于判断上传数量\n  },\n  watch: {\n    value: {\n      handler: function handler(val, oldValue) {\n        if (val instanceof Array) {\n          this.initFileList(val.join(','));\n        } else {\n          this.initFileList(val);\n        }\n        if (!val || val.length == 0) {\n          this.picUrl = false;\n        }\n      },\n      //立刻执行handler\n      immediate: true\n    }\n  },\n  created: function created() {\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    this.headers = {\n      \"X-Access-Token\": token\n    };\n  },\n  methods: {\n    initFileList: function initFileList(paths) {\n      if (!paths || paths.length == 0) {\n        this.fileList = [];\n        return;\n      }\n      this.picUrl = true;\n      var fileList = [];\n      var arr = paths.split(\",\");\n      for (var a = 0; a < arr.length; a++) {\n        var url = getFileAccessHttpUrl(arr[a]);\n        fileList.push({\n          uid: uidGenerator(),\n          name: getFileName(arr[a]),\n          status: 'done',\n          url: url,\n          response: {\n            status: \"history\",\n            message: arr[a]\n          }\n        });\n      }\n      this.fileList = fileList;\n    },\n    beforeUpload: function beforeUpload(file) {\n      var fileType = file.type;\n      if (fileType.indexOf('image') < 0) {\n        this.$message.warning('请上传图片');\n        return false;\n      }\n    },\n    handleChange: function handleChange(info) {\n      this.picUrl = false;\n      var fileList = info.fileList;\n      //update-begin-author:wangshuai date:20201022 for:LOWCOD-969 判断number是否大于0和是否多选，返回选定的元素。\n      if (this.number > 0 && this.isMultiple) {\n        fileList = fileList.slice(-this.number);\n      }\n      //update-end-author:wangshuai date:20201022 for:LOWCOD-969 判断number是否大于0和是否多选，返回选定的元素。\n      if (info.file.status === 'done') {\n        if (info.file.response.success) {\n          this.picUrl = true;\n          fileList = fileList.map(function (file) {\n            if (file.response) {\n              file.url = file.response.message;\n            }\n            return file;\n          });\n        }\n        //this.$message.success(`${info.file.name} 上传成功!`);\n      } else if (info.file.status === 'error') {\n        this.$message.error(\"\".concat(info.file.name, \" \\u4E0A\\u4F20\\u5931\\u8D25.\"));\n      } else if (info.file.status === 'removed') {\n        this.handleDelete(info.file);\n      }\n      this.fileList = fileList;\n      if (info.file.status === 'done' || info.file.status === 'removed') {\n        this.handlePathChange();\n      }\n    },\n    // 预览\n    handlePreview: function handlePreview(file) {\n      this.previewImage = file.url || file.thumbUrl;\n      this.previewVisible = true;\n    },\n    getAvatarView: function getAvatarView() {\n      if (this.fileList.length > 0) {\n        var url = this.fileList[0].url;\n        return getFileAccessHttpUrl(url);\n      }\n    },\n    handlePathChange: function handlePathChange() {\n      var uploadFiles = this.fileList;\n      var path = '';\n      if (!uploadFiles || uploadFiles.length == 0) {\n        path = '';\n      }\n      var arr = [];\n      if (!this.isMultiple && uploadFiles.length > 0) {\n        arr.push(uploadFiles[uploadFiles.length - 1].response.message);\n      } else {\n        for (var a = 0; a < uploadFiles.length; a++) {\n          // update-begin-author:taoyan date:20200819 for:【开源问题z】上传图片组件 LOWCOD-783\n          if (uploadFiles[a].status === 'done') {\n            arr.push(uploadFiles[a].response.message);\n          } else {\n            return;\n          }\n          // update-end-author:taoyan date:20200819 for:【开源问题z】上传图片组件 LOWCOD-783\n        }\n      }\n      if (arr.length > 0) {\n        path = arr.join(\",\");\n      }\n      this.$emit('change', path);\n    },\n    handleDelete: function handleDelete(file) {\n      //如有需要新增 删除逻辑\n      console.log(file);\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n      this.previewVisible = false;\n    },\n    close: function close() {}\n  },\n  model: {\n    prop: 'value',\n    event: 'change'\n  }\n};",{"version":3,"names":["Vue","ACCESS_TOKEN","getFileAccessHttpUrl","uidGenerator","parseInt","Math","random","getFileName","path","lastIndexOf","reg","RegExp","replace","substring","name","data","uploadAction","window","_CONFIG","uploadLoading","picUrl","headers","fileList","previewImage","previewVisible","props","text","type","String","required","default","bizPath","value","Array","disabled","Boolean","isMultiple","number","Number","watch","handler","val","oldValue","initFileList","join","length","immediate","created","token","ls","get","methods","paths","arr","split","a","url","push","uid","status","response","message","beforeUpload","file","fileType","indexOf","$message","warning","handleChange","info","slice","success","map","error","concat","handleDelete","handlePathChange","handlePreview","thumbUrl","getAvatarView","uploadFiles","$emit","console","log","handleCancel","close","model","prop","event"],"sources":["src/components/jeecg/JImageUpload.vue"],"sourcesContent":["<template>\n  <div class=\"img\">\n    <a-upload\n      name=\"file\"\n      listType=\"picture-card\"\n      :multiple=\"isMultiple\"\n      :action=\"uploadAction\"\n      :headers=\"headers\"\n      :data=\"{biz:bizPath}\"\n      :fileList=\"fileList\"\n      :beforeUpload=\"beforeUpload\"\n      :disabled=\"disabled\"\n      :isMultiple=\"isMultiple\"\n\n      @change=\"handleChange\"\n      @preview=\"handlePreview\"\n      :class=\"[!isMultiple?'imgupload':'', (!isMultiple && picUrl)?'image-upload-single-over':'' ]\">\n      <div>\n        <!--<img v-if=\"!isMultiple && picUrl\" :src=\"getAvatarView()\" style=\"width:100%;height:100%\"/>-->\n        <div class=\"iconp\">\n          <a-icon :type=\"uploadLoading ? 'loading' : 'plus'\" />\n          <div class=\"ant-upload-text\">{{ text }}</div>\n        </div>\n      </div>\n      <a-modal :visible=\"previewVisible\" :footer=\"null\" @cancel=\"handleCancel()\">\n        <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\"/>\n      </a-modal>\n    </a-upload>\n  </div>\n</template>\n\n<script>\n  import Vue from 'vue'\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\"\n  import { getFileAccessHttpUrl } from '@/api/manage'\n\n  const uidGenerator=()=>{\n    return '-'+parseInt(Math.random()*10000+1,10);\n  }\n  const getFileName=(path)=>{\n    if(path.lastIndexOf(\"\\\\\")>=0){\n      let reg=new RegExp(\"\\\\\\\\\",\"g\");\n      path = path.replace(reg,\"/\");\n    }\n    return path.substring(path.lastIndexOf(\"/\")+1);\n  }\n  export default {\n    name: 'JImageUpload',\n    data(){\n      return {\n        uploadAction:window._CONFIG['domianURL']+\"/sys/common/upload\",\n        uploadLoading:false,\n        picUrl:false,\n        headers:{},\n        fileList: [],\n        previewImage:\"\",\n        previewVisible: false,\n      }\n    },\n    props:{\n      text:{\n        type:String,\n        required:false,\n        default:\"上传\"\n      },\n      /*这个属性用于控制文件上传的业务路径*/\n      bizPath:{\n        type:String,\n        required:false,\n        default:\"temp\"\n      },\n      value:{\n        type:[String,Array],\n        required:false\n      },\n      disabled:{\n        type:Boolean,\n        required:false,\n        default: false\n      },\n      isMultiple:{\n        type:Boolean,\n        required:false,\n        default: false\n      },\n      //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 新增number属性，用于判断上传数量\n      number:{\n        type:Number,\n        required:false,\n        default:0\n      }\n      //update-end-author:wangshuai date:20201021 for:LOWCOD-969 新增number属性，用于判断上传数量\n    },\n    watch:{\n      value: {\n        handler(val,oldValue) {\n          if (val instanceof Array) {\n            this.initFileList(val.join(','))\n          } else {\n            this.initFileList(val)\n          }\n          if(!val || val.length==0){\n            this.picUrl = false;\n          }\n        },\n        //立刻执行handler\n        immediate: true\n      }\n    },\n    created(){\n      const token = Vue.ls.get(ACCESS_TOKEN);\n      this.headers = {\"X-Access-Token\":token}\n    },\n    methods:{\n      initFileList(paths){\n        if(!paths || paths.length==0){\n          this.fileList = [];\n          return;\n        }\n        this.picUrl = true;\n        let fileList = [];\n        let arr = paths.split(\",\")\n        for(var a=0;a<arr.length;a++){\n          let url = getFileAccessHttpUrl(arr[a]);\n          fileList.push({\n            uid: uidGenerator(),\n            name: getFileName(arr[a]),\n            status: 'done',\n            url: url,\n            response:{\n              status:\"history\",\n              message:arr[a]\n            }\n          })\n        }\n        this.fileList = fileList\n      },\n      beforeUpload: function(file){\n        var fileType = file.type;\n        if(fileType.indexOf('image')<0){\n          this.$message.warning('请上传图片');\n          return false;\n        }\n      },\n      handleChange(info) {\n        this.picUrl = false;\n        let fileList = info.fileList\n        //update-begin-author:wangshuai date:20201022 for:LOWCOD-969 判断number是否大于0和是否多选，返回选定的元素。\n        if(this.number>0 && this.isMultiple){\n          fileList = fileList.slice(-this.number);\n        }\n        //update-end-author:wangshuai date:20201022 for:LOWCOD-969 判断number是否大于0和是否多选，返回选定的元素。\n        if(info.file.status==='done'){\n          if(info.file.response.success){\n            this.picUrl = true;\n            fileList = fileList.map((file) => {\n              if (file.response) {\n                file.url = file.response.message;\n              }\n              return file;\n            });\n          }\n          //this.$message.success(`${info.file.name} 上传成功!`);\n        }else if (info.file.status === 'error') {\n          this.$message.error(`${info.file.name} 上传失败.`);\n        }else if(info.file.status === 'removed'){\n          this.handleDelete(info.file)\n        }\n        this.fileList = fileList\n        if(info.file.status==='done' || info.file.status === 'removed'){\n          this.handlePathChange()\n        }\n      },\n      // 预览\n      handlePreview (file) {\n        this.previewImage = file.url || file.thumbUrl\n        this.previewVisible = true\n      },\n      getAvatarView(){\n        if(this.fileList.length>0){\n          let url = this.fileList[0].url\n          return getFileAccessHttpUrl(url)\n        }\n      },\n      handlePathChange(){\n        let uploadFiles = this.fileList\n        let path = ''\n        if(!uploadFiles || uploadFiles.length==0){\n          path = ''\n        }\n        let arr = [];\n        if(!this.isMultiple && uploadFiles.length>0){\n          arr.push(uploadFiles[uploadFiles.length-1].response.message)\n        }else{\n          for(let a=0;a<uploadFiles.length;a++){\n            // update-begin-author:taoyan date:20200819 for:【开源问题z】上传图片组件 LOWCOD-783\n            if(uploadFiles[a].status === 'done' ) {\n              arr.push(uploadFiles[a].response.message)\n            }else{\n              return;\n            }\n            // update-end-author:taoyan date:20200819 for:【开源问题z】上传图片组件 LOWCOD-783\n          }\n        }\n        if(arr.length>0){\n          path = arr.join(\",\")\n        }\n        this.$emit('change', path);\n      },\n      handleDelete(file){\n        //如有需要新增 删除逻辑\n        console.log(file)\n      },\n      handleCancel() {\n        this.close();\n        this.previewVisible = false;\n      },\n      close () {\n\n      },\n    },\n    model: {\n      prop: 'value',\n      event: 'change'\n    }\n  }\n</script>\n\n<style scoped>\n  /* update--begin--autor:lvdandan-----date:20201016------for：j-image-upload图片组件单张图片详情回显空白\n  * https://github.com/zhangdaiscott/jeecg-boot/issues/1810\n  * https://github.com/zhangdaiscott/jeecg-boot/issues/1779\n  */\n\n  /deep/ .imgupload .iconp{padding:20px;}\n  /* update--end--autor:lvdandan-----date:20201016------for：j-image-upload图片组件单张图片详情回显空白*/\n\n  /deep/ .image-upload-single-over .ant-upload-select{display: none}\n</style>\n"],"mappings":"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","ignoreList":[]}]}