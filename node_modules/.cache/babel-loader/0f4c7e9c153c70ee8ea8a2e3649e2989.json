{"remainingRequest":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js!F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\workspace\\3月\\知识库系统\\admin\\src\\components\\jeecg\\JVxeTable\\components\\cells\\JVxeUploadCell.vue?vue&type=script&lang=js","dependencies":[{"path":"F:\\workspace\\3月\\知识库系统\\admin\\src\\components\\jeecg\\JVxeTable\\components\\cells\\JVxeUploadCell.vue","mtime":1704718217000},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\babel.config.js","mtime":1704718217000},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1709701155248},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1709701140363},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1709701155248},{"path":"F:\\workspace\\3月\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1709701116791}],"contextDependencies":[],"result":["import JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport { getFileAccessHttpUrl } from '@api/manage';\nexport default {\n  name: 'JVxeUploadCell',\n  mixins: [JVxeCellMixins],\n  props: {},\n  data: function data() {\n    return {\n      innerFile: null\n    };\n  },\n  computed: {\n    /** upload headers */uploadHeaders: function uploadHeaders() {\n      var col = this.originColumn;\n      var headers = {};\n      if (col.token === true) {\n        headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN);\n      }\n      return headers;\n    },\n    hasFile: function hasFile() {\n      return this.innerFile != null;\n    }\n  },\n  watch: {\n    innerValue: {\n      immediate: true,\n      handler: function handler() {\n        if (this.innerValue) {\n          this.innerFile = this.innerValue;\n        } else {\n          this.innerFile = null;\n        }\n      }\n    }\n  },\n  methods: {\n    handleChangeUpload: function handleChangeUpload(info) {\n      var row = this.row,\n        col = this.originColumn;\n      var file = info.file;\n      var value = {\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        status: file.status,\n        percent: file.percent\n      };\n      if (col.responseName && file.response) {\n        value['responseName'] = file.response[col.responseName];\n      }\n      if (file.status === 'done') {\n        value['path'] = file.response[col.responseName];\n        this.handleChangeCommon(value);\n      } else if (file.status === 'error') {\n        value['message'] = file.response.message || '未知错误';\n      }\n      this.innerFile = value;\n    },\n    // handleClickPreviewFile(id) {\n    //   this.$message.info('尚未实现')\n    // },\n    handleClickDownloadFile: function handleClickDownloadFile(id) {\n      var _ref = this.value || {},\n        path = _ref.path;\n      if (path) {\n        var url = getFileAccessHttpUrl(path);\n        window.open(url);\n      }\n    },\n    handleClickDeleteFile: function handleClickDeleteFile() {\n      this.handleChangeCommon(null);\n    }\n  },\n  // 【组件增强】注释详见：JVxeCellMixins.js\n  enhanced: {\n    switches: {\n      visible: true\n    },\n    getValue: function getValue(value) {\n      return fileGetValue(value);\n    },\n    setValue: function setValue(value) {\n      return fileSetValue(value);\n    }\n  }\n};\nfunction fileGetValue(value) {\n  if (value && value.path) {\n    return value.path;\n  }\n  return value;\n}\nfunction fileSetValue(value) {\n  if (value) {\n    var first = value.split(',')[0];\n    var name = first.substring(first.lastIndexOf('/') + 1);\n    return {\n      name: name,\n      path: value,\n      status: 'done'\n    };\n  }\n  return value;\n}",{"version":3,"names":["JVxeCellMixins","ACCESS_TOKEN","getFileAccessHttpUrl","name","mixins","props","data","innerFile","computed","uploadHeaders","col","originColumn","headers","token","$ls","get","hasFile","watch","innerValue","immediate","handler","methods","handleChangeUpload","info","row","file","value","type","size","status","percent","responseName","response","handleChangeCommon","message","handleClickDownloadFile","id","_ref","path","url","window","open","handleClickDeleteFile","enhanced","switches","visible","getValue","fileGetValue","setValue","fileSetValue","first","split","substring","lastIndexOf"],"sources":["src/components/jeecg/JVxeTable/components/cells/JVxeUploadCell.vue"],"sourcesContent":["<template>\n  <div>\n    <template v-if=\"hasFile\" v-for=\"(file, fileKey) of [innerFile || {}]\">\n      <a-input\n        :key=\"fileKey\"\n        :readOnly=\"true\"\n        :value=\"file.name\"\n      >\n\n        <template slot=\"addonBefore\" style=\"width: 30px\">\n          <a-tooltip v-if=\"file.status === 'uploading'\" :title=\"`上传中(${Math.floor(file.percent)}%)`\">\n            <a-icon type=\"loading\"/>\n          </a-tooltip>\n          <a-tooltip v-else-if=\"file.status === 'done'\" title=\"上传完成\">\n            <a-icon type=\"check-circle\" style=\"color:#00DB00;\"/>\n          </a-tooltip>\n          <a-tooltip v-else title=\"上传失败\">\n            <a-icon type=\"exclamation-circle\" style=\"color:red;\"/>\n          </a-tooltip>\n        </template>\n\n        <span v-if=\"file.status === 'uploading'\" slot=\"addonAfter\">{{ Math.floor(file.percent) }}%</span>\n        <template v-else-if=\"originColumn.allowDownload !== false || originColumn.allowRemove !== false\" slot=\"addonAfter\">\n          <a-dropdown :trigger=\"['click']\" placement=\"bottomRight\">\n            <a-tooltip title=\"操作\">\n              <a-icon\n                type=\"setting\"\n                style=\"cursor: pointer;\"/>\n            </a-tooltip>\n\n            <a-menu slot=\"overlay\">\n              <!-- <a-menu-item @click=\"handleClickPreviewFile\">-->\n              <!--  <span><a-icon type=\"eye\"/>&nbsp;预览</span>-->\n              <!-- </a-menu-item>-->\n              <a-menu-item v-if=\"originColumn.allowDownload !== false\" @click=\"handleClickDownloadFile\">\n                <span><a-icon type=\"download\"/>&nbsp;下载</span>\n              </a-menu-item>\n              <a-menu-item v-if=\"originColumn.allowRemove !== false\" @click=\"handleClickDeleteFile\">\n                <span><a-icon type=\"delete\"/>&nbsp;删除</span>\n              </a-menu-item>\n            </a-menu>\n          </a-dropdown>\n        </template>\n\n      </a-input>\n    </template>\n    <a-upload\n      v-show=\"!hasFile\"\n      name=\"file\"\n      :data=\"{'isup': 1}\"\n      :multiple=\"false\"\n      :action=\"originColumn.action\"\n      :headers=\"uploadHeaders\"\n      :showUploadList=\"false\"\n      v-bind=\"cellProps\"\n      @change=\"handleChangeUpload\"\n    >\n      <a-button icon=\"upload\">{{originColumn.btnText || '点击上传'}}</a-button>\n    </a-upload>\n  </div>\n</template>\n\n<script>\n  import JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins'\n  import { ACCESS_TOKEN } from '@/store/mutation-types'\n  import { getFileAccessHttpUrl } from '@api/manage'\n\n  export default {\n    name: 'JVxeUploadCell',\n    mixins: [JVxeCellMixins],\n    props: {},\n    data() {\n      return {\n        innerFile: null,\n      }\n    },\n    computed: {\n      /** upload headers */\n      uploadHeaders() {\n        let {originColumn: col} = this\n        let headers = {}\n        if (col.token === true) {\n          headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN)\n        }\n        return headers\n      },\n\n      hasFile() {\n        return this.innerFile != null\n      },\n\n    },\n    watch: {\n      innerValue: {\n        immediate: true,\n        handler() {\n          if (this.innerValue) {\n            this.innerFile = this.innerValue\n          } else {\n            this.innerFile = null\n          }\n        },\n      },\n    },\n    methods: {\n\n      handleChangeUpload(info) {\n        let {row, originColumn: col} = this\n        let {file} = info\n        let value = {\n          name: file.name,\n          type: file.type,\n          size: file.size,\n          status: file.status,\n          percent: file.percent\n        }\n        if (col.responseName && file.response) {\n          value['responseName'] = file.response[col.responseName]\n        }\n        if (file.status === 'done') {\n          value['path'] = file.response[col.responseName]\n          this.handleChangeCommon(value)\n        } else if (file.status === 'error') {\n          value['message'] = file.response.message || '未知错误'\n        }\n        this.innerFile = value\n      },\n\n      // handleClickPreviewFile(id) {\n      //   this.$message.info('尚未实现')\n      // },\n\n      handleClickDownloadFile(id) {\n        let {path} = this.value || {}\n        if (path) {\n          let url = getFileAccessHttpUrl(path)\n          window.open(url)\n        }\n      },\n\n      handleClickDeleteFile() {\n        this.handleChangeCommon(null)\n      },\n\n    },\n    // 【组件增强】注释详见：JVxeCellMixins.js\n    enhanced: {\n      switches: {visible: true},\n      getValue: value => fileGetValue(value),\n      setValue: value => fileSetValue(value),\n    }\n  }\n\n  function fileGetValue(value) {\n    if (value && value.path) {\n      return value.path\n    }\n    return value\n  }\n\n  function fileSetValue(value) {\n    if (value) {\n      let first = value.split(',')[0]\n      let name = first.substring(first.lastIndexOf('/') + 1)\n      return {\n        name: name,\n        path: value,\n        status: 'done',\n      }\n    }\n    return value\n  }\n\n</script>\n\n<style scoped>\n\n</style>"],"mappings":"AA+DA,OAAAA,cAAA;AACA,SAAAC,YAAA;AACA,SAAAC,oBAAA;AAEA;EACAC,IAAA;EACAC,MAAA,GAAAJ,cAAA;EACAK,KAAA;EACAC,IAAA,WAAAA,KAAA;IACA;MACAC,SAAA;IACA;EACA;EACAC,QAAA;IACA,qBACAC,aAAA,WAAAA,cAAA;MACA,IAAAC,GAAA,QAAAC,YAAA;MACA,IAAAC,OAAA;MACA,IAAAF,GAAA,CAAAG,KAAA;QACAD,OAAA,0BAAAE,GAAA,CAAAC,GAAA,CAAAd,YAAA;MACA;MACA,OAAAW,OAAA;IACA;IAEAI,OAAA,WAAAA,QAAA;MACA,YAAAT,SAAA;IACA;EAEA;EACAU,KAAA;IACAC,UAAA;MACAC,SAAA;MACAC,OAAA,WAAAA,QAAA;QACA,SAAAF,UAAA;UACA,KAAAX,SAAA,QAAAW,UAAA;QACA;UACA,KAAAX,SAAA;QACA;MACA;IACA;EACA;EACAc,OAAA;IAEAC,kBAAA,WAAAA,mBAAAC,IAAA;MACA,IAAAC,GAAA,QAAAA,GAAA;QAAAd,GAAA,QAAAC,YAAA;MACA,IAAAc,IAAA,GAAAF,IAAA,CAAAE,IAAA;MACA,IAAAC,KAAA;QACAvB,IAAA,EAAAsB,IAAA,CAAAtB,IAAA;QACAwB,IAAA,EAAAF,IAAA,CAAAE,IAAA;QACAC,IAAA,EAAAH,IAAA,CAAAG,IAAA;QACAC,MAAA,EAAAJ,IAAA,CAAAI,MAAA;QACAC,OAAA,EAAAL,IAAA,CAAAK;MACA;MACA,IAAApB,GAAA,CAAAqB,YAAA,IAAAN,IAAA,CAAAO,QAAA;QACAN,KAAA,mBAAAD,IAAA,CAAAO,QAAA,CAAAtB,GAAA,CAAAqB,YAAA;MACA;MACA,IAAAN,IAAA,CAAAI,MAAA;QACAH,KAAA,WAAAD,IAAA,CAAAO,QAAA,CAAAtB,GAAA,CAAAqB,YAAA;QACA,KAAAE,kBAAA,CAAAP,KAAA;MACA,WAAAD,IAAA,CAAAI,MAAA;QACAH,KAAA,cAAAD,IAAA,CAAAO,QAAA,CAAAE,OAAA;MACA;MACA,KAAA3B,SAAA,GAAAmB,KAAA;IACA;IAEA;IACA;IACA;IAEAS,uBAAA,WAAAA,wBAAAC,EAAA;MACA,IAAAC,IAAA,QAAAX,KAAA;QAAAY,IAAA,GAAAD,IAAA,CAAAC,IAAA;MACA,IAAAA,IAAA;QACA,IAAAC,GAAA,GAAArC,oBAAA,CAAAoC,IAAA;QACAE,MAAA,CAAAC,IAAA,CAAAF,GAAA;MACA;IACA;IAEAG,qBAAA,WAAAA,sBAAA;MACA,KAAAT,kBAAA;IACA;EAEA;EACA;EACAU,QAAA;IACAC,QAAA;MAAAC,OAAA;IAAA;IACAC,QAAA,WAAAA,SAAApB,KAAA;MAAA,OAAAqB,YAAA,CAAArB,KAAA;IAAA;IACAsB,QAAA,WAAAA,SAAAtB,KAAA;MAAA,OAAAuB,YAAA,CAAAvB,KAAA;IAAA;EACA;AACA;AAEA,SAAAqB,aAAArB,KAAA;EACA,IAAAA,KAAA,IAAAA,KAAA,CAAAY,IAAA;IACA,OAAAZ,KAAA,CAAAY,IAAA;EACA;EACA,OAAAZ,KAAA;AACA;AAEA,SAAAuB,aAAAvB,KAAA;EACA,IAAAA,KAAA;IACA,IAAAwB,KAAA,GAAAxB,KAAA,CAAAyB,KAAA;IACA,IAAAhD,IAAA,GAAA+C,KAAA,CAAAE,SAAA,CAAAF,KAAA,CAAAG,WAAA;IACA;MACAlD,IAAA,EAAAA,IAAA;MACAmC,IAAA,EAAAZ,KAAA;MACAG,MAAA;IACA;EACA;EACA,OAAAH,KAAA;AACA","ignoreList":[]}]}