{"remainingRequest":"E:\\work-25\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js!E:\\work-25\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\work-25\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\work-25\\知识库系统\\admin\\src\\components\\JVxeCells\\JVxeImageCell.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\work-25\\知识库系统\\admin\\src\\components\\JVxeCells\\JVxeImageCell.vue","mtime":1704718216000},{"path":"E:\\work-25\\知识库系统\\admin\\babel.config.js","mtime":1704718216000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { getFileAccessHttpUrl } from '@api/manage';\nimport JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport JFilePop from '@/components/jeecg/minipop/JFilePop';\nimport JVxeUploadCell from '@/components/jeecg/JVxeTable/components/cells/JVxeUploadCell';\nexport default {\n  name: 'JVxeImageCell',\n  mixins: [JVxeCellMixins],\n  components: {\n    JFilePop: JFilePop\n  },\n  props: {},\n  data: function data() {\n    return {\n      innerFile: null,\n      number: 0\n    };\n  },\n  computed: {\n    /** upload headers */uploadHeaders: function uploadHeaders() {\n      var col = this.originColumn;\n      var headers = {};\n      if (col.token === true) {\n        headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN);\n      }\n      return headers;\n    },\n    /** 上传请求地址 */uploadAction: function uploadAction() {\n      if (!this.originColumn.action) {\n        return window._CONFIG['domianURL'] + '/sys/common/upload';\n      } else {\n        return this.originColumn.action;\n      }\n    },\n    hasFile: function hasFile() {\n      return this.innerFile != null;\n    },\n    /** 预览图片地址 */imgSrc: function imgSrc() {\n      if (this.innerFile) {\n        if (this.innerFile['url']) {\n          return this.innerFile['url'];\n        } else if (this.innerFile['path']) {\n          var path = this.innerFile['path'].split(',')[0];\n          return getFileAccessHttpUrl(path);\n        }\n      }\n      return '';\n    },\n    responseName: function responseName() {\n      if (this.originColumn.responseName) {\n        return this.originColumn.responseName;\n      } else {\n        return 'message';\n      }\n    }\n  },\n  watch: {\n    innerValue: {\n      immediate: true,\n      handler: function handler() {\n        if (this.innerValue) {\n          this.innerFile = this.innerValue;\n        } else {\n          this.innerFile = null;\n        }\n      }\n    }\n  },\n  methods: {\n    // 点击更多按钮\n    handleMoreOperation: function handleMoreOperation(originColumn) {\n      //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n      if (originColumn.number) {\n        this.number = originColumn.number;\n      } else {\n        this.number = 0;\n      }\n      //update-end-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n      if (originColumn && originColumn.fieldExtendJson) {\n        var json = JSON.parse(originColumn.fieldExtendJson);\n        this.number = json.uploadnum ? json.uploadnum : 0;\n      }\n      var path = '';\n      if (this.innerFile) {\n        path = this.innerFile.path;\n      }\n      this.$refs.filePop.show('', path, 'img');\n    },\n    // 更多上传回调\n    handleFileSuccess: function handleFileSuccess(file) {\n      if (file) {\n        this.innerFile.path = file.path;\n        this.handleChangeCommon(this.innerFile);\n      }\n    },\n    // 弹出上传出错详细信息\n    handleClickShowImageError: function handleClickShowImageError() {\n      var file = this.innerFile || null;\n      if (file && file['message']) {\n        this.$error({\n          title: '上传出错',\n          content: '错误信息：' + file['message'],\n          maskClosable: true\n        });\n      }\n    },\n    handleChangeUpload: function handleChangeUpload(info) {\n      var col = this.originColumn;\n      var file = info.file;\n      var value = {\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        status: file.status,\n        percent: file.percent\n      };\n      if (file.response) {\n        value['responseName'] = file.response[this.responseName];\n      }\n      if (file.status === 'done') {\n        value['path'] = file.response[this.responseName];\n        this.handleChangeCommon(value);\n      } else if (file.status === 'error') {\n        value['message'] = file.response.message || '未知错误';\n      }\n      this.innerFile = value;\n    },\n    handleClickDownloadFile: function handleClickDownloadFile() {\n      if (this.imgSrc) {\n        window.open(this.imgSrc);\n      }\n    },\n    handleClickDeleteFile: function handleClickDeleteFile() {\n      this.handleChangeCommon(null);\n    }\n  },\n  // 【组件增强】注释详见：JVxeCellMixins.js\n  enhanced: {\n    switches: {\n      visible: true\n    },\n    getValue: function getValue(value) {\n      return JVxeUploadCell.enhanced.getValue(value);\n    },\n    setValue: function setValue(value) {\n      return JVxeUploadCell.enhanced.setValue(value);\n    }\n  }\n};",{"version":3,"names":["getFileAccessHttpUrl","JVxeCellMixins","ACCESS_TOKEN","JFilePop","JVxeUploadCell","name","mixins","components","props","data","innerFile","number","computed","uploadHeaders","col","originColumn","headers","token","$ls","get","uploadAction","action","window","_CONFIG","hasFile","imgSrc","path","split","responseName","watch","innerValue","immediate","handler","methods","handleMoreOperation","fieldExtendJson","json","JSON","parse","uploadnum","$refs","filePop","show","handleFileSuccess","file","handleChangeCommon","handleClickShowImageError","$error","title","content","maskClosable","handleChangeUpload","info","value","type","size","status","percent","response","message","handleClickDownloadFile","open","handleClickDeleteFile","enhanced","switches","visible","getValue","setValue"],"sources":["src/components/JVxeCells/JVxeImageCell.vue"],"sourcesContent":["<template>\n  <div>\n    <template v-if=\"hasFile\" v-for=\"(file, fileKey) of [innerFile || {}]\">\n      <div :key=\"fileKey\" style=\"position: relative;\">\n        <template v-if=\"!file || !(file['url'] || file['path'] || file['message'])\">\n          <a-tooltip :title=\"'请稍后: ' + JSON.stringify (file) + ((file['url'] || file['path'] || file['message']))\">\n            <a-icon type=\"loading\"/>\n          </a-tooltip>\n        </template>\n        <template v-else-if=\"file['path']\">\n          <img class=\"j-editable-image\" :src=\"imgSrc\" alt=\"无图片\" @click=\"handleMoreOperation\"/>\n        </template>\n        <template v-else>\n          <a-icon type=\"exclamation-circle\" style=\"color: red;\" @click=\"handleClickShowImageError\"/>\n        </template>\n        <template slot=\"addonBefore\" style=\"width: 30px\">\n          <a-tooltip v-if=\"file.status==='uploading'\" :title=\"`上传中(${Math.floor(file.percent)}%)`\">\n            <a-icon type=\"loading\"/>\n          </a-tooltip>\n          <a-tooltip v-else-if=\"file.status==='done'\" title=\"上传完成\">\n            <a-icon type=\"check-circle\" style=\"color:#00DB00;\"/>\n          </a-tooltip>\n          <a-tooltip v-else title=\"上传失败\">\n            <a-icon type=\"exclamation-circle\" style=\"color:red;\"/>\n          </a-tooltip>\n        </template>\n\n        <template style=\"width: 30px\">\n          <a-dropdown :trigger=\"['click']\" placement=\"bottomRight\" style=\"margin-left: 10px;\">\n            <a-tooltip title=\"操作\">\n              <a-icon\n                v-if=\"file.status!=='uploading'\"\n                type=\"setting\"\n                style=\"cursor: pointer;\"/>\n            </a-tooltip>\n\n            <a-menu slot=\"overlay\">\n              <a-menu-item v-if=\"originColumn.allowDownload !== false\" @click=\"handleClickDownloadFile\">\n                <span><a-icon type=\"download\"/>&nbsp;下载</span>\n              </a-menu-item>\n              <a-menu-item v-if=\"originColumn.allowRemove !== false\" @click=\"handleClickDeleteFile\">\n                <span><a-icon type=\"delete\"/>&nbsp;删除</span>\n              </a-menu-item>\n              <a-menu-item @click=\"handleMoreOperation(originColumn)\">\n                <span><a-icon type=\"bars\"/> 更多</span>\n              </a-menu-item>\n            </a-menu>\n          </a-dropdown>\n        </template>\n\n      </div>\n    </template>\n    <a-upload\n      v-show=\"!hasFile\"\n      name=\"file\"\n      :data=\"{'isup': 1}\"\n      :multiple=\"false\"\n      :action=\"uploadAction\"\n      :headers=\"uploadHeaders\"\n      :showUploadList=\"false\"\n      v-bind=\"cellProps\"\n      @change=\"handleChangeUpload\"\n    >\n      <a-button icon=\"upload\">{{originColumn.btnText || '上传图片'}}</a-button>\n    </a-upload>\n    <j-file-pop ref=\"filePop\" @ok=\"handleFileSuccess\" :number=\"number\"/>\n  </div>\n</template>\n\n<script>\n  import { getFileAccessHttpUrl } from '@api/manage'\n  import JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins'\n  import { ACCESS_TOKEN } from '@/store/mutation-types'\n  import JFilePop from '@/components/jeecg/minipop/JFilePop'\n\n  import JVxeUploadCell from '@/components/jeecg/JVxeTable/components/cells/JVxeUploadCell'\n\n  export default {\n    name: 'JVxeImageCell',\n    mixins: [JVxeCellMixins],\n    components: {JFilePop},\n    props: {},\n    data() {\n      return {\n        innerFile: null,\n        number:0\n      }\n    },\n    computed: {\n      /** upload headers */\n      uploadHeaders() {\n        let {originColumn: col} = this\n        let headers = {}\n        if (col.token === true) {\n          headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN)\n        }\n        return headers\n      },\n\n      /** 上传请求地址 */\n      uploadAction() {\n        if (!this.originColumn.action) {\n          return window._CONFIG['domianURL'] + '/sys/common/upload'\n        } else {\n          return this.originColumn.action\n        }\n      },\n\n      hasFile() {\n        return this.innerFile != null\n      },\n\n      /** 预览图片地址 */\n      imgSrc() {\n        if (this.innerFile) {\n          if (this.innerFile['url']) {\n            return this.innerFile['url']\n          } else if (this.innerFile['path']) {\n            let path = this.innerFile['path'].split(',')[0]\n            return getFileAccessHttpUrl(path)\n          }\n        }\n        return ''\n      },\n\n      responseName() {\n        if (this.originColumn.responseName) {\n          return this.originColumn.responseName\n        } else {\n          return 'message'\n        }\n      },\n\n    },\n    watch: {\n      innerValue: {\n        immediate: true,\n        handler() {\n          if (this.innerValue) {\n            this.innerFile = this.innerValue\n          } else {\n            this.innerFile = null\n          }\n        },\n      },\n    },\n    methods: {\n\n      // 点击更多按钮\n      handleMoreOperation(originColumn) {\n        //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n        if (originColumn.number) {\n          this.number = originColumn.number\n        } else {\n          this.number = 0\n        }\n        //update-end-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n        if(originColumn && originColumn.fieldExtendJson){\n          let json = JSON.parse(originColumn.fieldExtendJson);\n          this.number = json.uploadnum?json.uploadnum:0;\n        }\n        let path = ''\n        if (this.innerFile) {\n          path = this.innerFile.path\n        }\n        this.$refs.filePop.show('', path, 'img')\n      },\n\n      // 更多上传回调\n      handleFileSuccess(file) {\n        if (file) {\n          this.innerFile.path = file.path\n          this.handleChangeCommon(this.innerFile)\n        }\n      },\n\n      // 弹出上传出错详细信息\n      handleClickShowImageError() {\n        let file = this.innerFile || null\n        if (file && file['message']) {\n          this.$error({title: '上传出错', content: '错误信息：' + file['message'], maskClosable: true})\n        }\n      },\n\n      handleChangeUpload(info) {\n        let {originColumn: col} = this\n        let {file} = info\n        let value = {\n          name: file.name,\n          type: file.type,\n          size: file.size,\n          status: file.status,\n          percent: file.percent\n        }\n        if (file.response) {\n          value['responseName'] = file.response[this.responseName]\n        }\n        if (file.status === 'done') {\n          value['path'] = file.response[this.responseName]\n          this.handleChangeCommon(value)\n        } else if (file.status === 'error') {\n          value['message'] = file.response.message || '未知错误'\n        }\n        this.innerFile = value\n      },\n\n      handleClickDownloadFile() {\n        if (this.imgSrc) {\n          window.open(this.imgSrc)\n        }\n      },\n\n      handleClickDeleteFile() {\n        this.handleChangeCommon(null)\n      },\n\n    },\n    // 【组件增强】注释详见：JVxeCellMixins.js\n    enhanced: {\n      switches: {visible: true},\n      getValue: value => JVxeUploadCell.enhanced.getValue(value),\n      setValue: value => JVxeUploadCell.enhanced.setValue(value),\n    }\n  }\n</script>\n\n<style scoped lang=\"less\">\n  .j-editable-image {\n    height: 32px;\n    max-width: 100px !important;\n    cursor: pointer;\n\n    &:hover {\n      opacity: 0.8;\n    }\n\n    &:active {\n      opacity: 0.6;\n    }\n\n  }\n</style>\n"],"mappings":"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","ignoreList":[]}]}