{"remainingRequest":"E:\\work-25\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js!E:\\work-25\\知识库系统\\admin\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\work-25\\知识库系统\\admin\\src\\permission.js","dependencies":[{"path":"E:\\work-25\\知识库系统\\admin\\src\\permission.js","mtime":1704718216000},{"path":"E:\\work-25\\知识库系统\\admin\\babel.config.js","mtime":1704718216000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\work-25\\知识库系统\\admin\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport Vue from 'vue';\nimport router from './router';\nimport store from './store';\nimport NProgress from 'nprogress'; // progress bar\nimport 'nprogress/nprogress.css'; // progress bar style\nimport notification from 'ant-design-vue/es/notification';\nimport { ACCESS_TOKEN, INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types';\nimport { generateIndexRouter } from \"@/utils/util\";\nNProgress.configure({\n  showSpinner: false\n}); // NProgress Configuration\n\nvar whiteList = ['/user/login', '/user/register', '/user/register-result', '/user/alteration', '/login']; // no redirect whitelist\n\nrouter.beforeEach(function (to, from, next) {\n  NProgress.start(); // start progress bar\n\n  if (Vue.ls.get(ACCESS_TOKEN)) {\n    /* has token */\n    if (to.path === '/user/login') {\n      next({\n        path: INDEX_MAIN_PAGE_PATH\n      });\n      NProgress.done();\n    } else {\n      if (store.getters.permissionList.length === 0) {\n        store.dispatch('GetPermissionList').then(function (res) {\n          var menuData = res.result.menu;\n          //console.log(res.message)\n          if (menuData === null || menuData === \"\" || menuData === undefined) {\n            return;\n          }\n          var constRoutes = [];\n          constRoutes = generateIndexRouter(menuData);\n          // 添加主界面路由\n          store.dispatch('UpdateAppRouter', {\n            constRoutes: constRoutes\n          }).then(function () {\n            // 根据roles权限生成可访问的路由表\n            // 动态添加可访问路由表\n            router.addRoutes(store.getters.addRouters);\n            var redirect = decodeURIComponent(from.query.redirect || to.path);\n            if (to.path === redirect) {\n              // hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record\n              next(_objectSpread(_objectSpread({}, to), {}, {\n                replace: true\n              }));\n            } else {\n              // 跳转到目的路由\n              next({\n                path: redirect\n              });\n            }\n          });\n        }).catch(function (err) {\n          console.log(err);\n          /* notification.error({\n             message: '系统提示',\n             description: '请求用户信息失败，请重试！'\n           })*/\n          store.dispatch('Logout').then(function () {\n            next({\n              path: '/user/login'\n            });\n            // next({ path: '/user/login', query: { redirect: to.fullPath } })\n          });\n        });\n      } else {\n        next();\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next();\n    } else {\n      // 调整没有token重定向问题，默认为系统内登录\n      // 第三方登录为 /login\n      next({\n        path: '/user/login'\n      });\n      // next({ path: '/user/login', query: { redirect: to.fullPath } })\n      NProgress.done(); // if current page is login will not trigger afterEach hook, so manually handle it\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done(); // finish progress bar\n});",{"version":3,"names":["Vue","router","store","NProgress","notification","ACCESS_TOKEN","INDEX_MAIN_PAGE_PATH","generateIndexRouter","configure","showSpinner","whiteList","beforeEach","to","from","next","start","ls","get","path","done","getters","permissionList","length","dispatch","then","res","menuData","result","menu","undefined","constRoutes","addRoutes","addRouters","redirect","decodeURIComponent","query","_objectSpread","replace","catch","err","console","log","indexOf","afterEach"],"sources":["E:/work-25/知识库系统/admin/src/permission.js"],"sourcesContent":["import Vue from 'vue'\nimport router from './router'\nimport store from './store'\nimport NProgress from 'nprogress' // progress bar\nimport 'nprogress/nprogress.css' // progress bar style\nimport notification from 'ant-design-vue/es/notification'\nimport { ACCESS_TOKEN,INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\nimport { generateIndexRouter } from \"@/utils/util\"\n\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\n\nconst whiteList = ['/user/login', '/user/register', '/user/register-result','/user/alteration','/login',] // no redirect whitelist\n\nrouter.beforeEach((to, from, next) => {\n  NProgress.start() // start progress bar\n\n  if (Vue.ls.get(ACCESS_TOKEN)) {\n    /* has token */\n    if (to.path === '/user/login') {\n      next({ path: INDEX_MAIN_PAGE_PATH })\n      NProgress.done()\n    } else {\n      if (store.getters.permissionList.length === 0) {\n        store.dispatch('GetPermissionList').then(res => {\n              const menuData = res.result.menu;\n              //console.log(res.message)\n              if (menuData === null || menuData === \"\" || menuData === undefined) {\n                return;\n              }\n              let constRoutes = [];\n              constRoutes = generateIndexRouter(menuData);\n              // 添加主界面路由\n              store.dispatch('UpdateAppRouter',  { constRoutes }).then(() => {\n                // 根据roles权限生成可访问的路由表\n                // 动态添加可访问路由表\n                router.addRoutes(store.getters.addRouters)\n                const redirect = decodeURIComponent(from.query.redirect || to.path)\n                if (to.path === redirect) {\n                  // hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record\n                  next({ ...to, replace: true })\n                } else {\n                  // 跳转到目的路由\n                  next({ path: redirect })\n                }\n              })\n            })\n          .catch(err => {\n            console.log(err)\n           /* notification.error({\n              message: '系统提示',\n              description: '请求用户信息失败，请重试！'\n            })*/\n            store.dispatch('Logout').then(() => {\n              next({path:'/user/login'});\n              // next({ path: '/user/login', query: { redirect: to.fullPath } })\n            })\n          })\n      } else {\n        next()\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next()\n    } else {\n      // 调整没有token重定向问题，默认为系统内登录\n      // 第三方登录为 /login\n      next({path:'/user/login'});\n      // next({ path: '/user/login', query: { redirect: to.fullPath } })\n      NProgress.done() // if current page is login will not trigger afterEach hook, so manually handle it\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done() // finish progress bar\n})\n"],"mappings":"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","ignoreList":[]}]}